package com.xinput.wechat;import com.xinput.bleach.util.BuilderUtils;import com.xinput.bleach.util.JsonUtils;import com.xinput.bleach.util.Logs;import com.xinput.bleach.util.ObjectId;import com.xinput.wechat.config.WechatConfig;import com.xinput.wechat.exception.WechatPayException;import com.xinput.wechat.request.OrderQueryRequest;import com.xinput.wechat.request.UnifiedOrderRequest;import com.xinput.wechat.response.OrderQueryResponse;import com.xinput.wechat.response.UnifiedOrderResponse;import com.xinput.wechat.result.OrderSignature;import org.junit.jupiter.api.Test;import org.slf4j.Logger;/** * 用例7【扫码-异常】订单金额3.34元，用户支付成功，微信支付通知关键信息不一致 * 【必选】支付异常用例集 * <p> * 用例名:【扫码-异常】订单金额3.34元，用户支付成功，微信支付通知关键信息不一致 * 用例说明: 交易安全验证。在微信支付通知非法的情况下，商户侧是否正确处理。 * <p> * 测试步骤 * 1、用客户端扫码(选择商品下单)，调起微信支付交易确认页；(调下单api: https://api.mch.weixin.qq.com/sandboxnew/pay/unifiedorder) * 2、等待5秒，用户完成支付； * 3、调用查单api，与商户自有订单的关键信息进行核对。 * * @author <a href="mailto:xinput.xx@gmail.com">xinput</a> * @date 2020-09-29 17:45 */public class Case_07 {    private static final Logger logger = Logs.get();    private static final String transaction_id = "4436436506420200929185248653427";    private static final String out_trade_no = "5f7311da6b5adf9bcfafc3ba";    @Test    public void unifiedOrder() throws WechatPayException {        UnifiedOrderRequest request = BuilderUtils.of(UnifiedOrderRequest::new)                // 商品名称                .with(UnifiedOrderRequest::setBody, "嘉云升-阿米洛机械键盘334")                // 获取客户端的ip地址                .with(UnifiedOrderRequest::setSpbill_create_ip, "192.168.10.13")                // 商户订单号,自己的订单ID                .with(UnifiedOrderRequest::setOut_trade_no, ObjectId.stringId())                // 支付金额                .with(UnifiedOrderRequest::setTotal_fee, 334)                // 支付成功后的回调地址                .with(UnifiedOrderRequest::setNotify_url, WechatConfig.getWechatNotifyUnifiedOrderUrl())                // 支付方式                .with(UnifiedOrderRequest::setTrade_type, "JSAPI")                .with(UnifiedOrderRequest::setDevice_info, "青轴机械键盘334")                .build();        UnifiedOrderResponse response = WechatPayApi.unifiedOrder(request);        logger.info("UnifiedOrderResponse : {}", JsonUtils.toJsonString(response, true));        // 再次签名        OrderSignature orderSignature = new OrderSignature(response);        logger.info("orderSignature : " + JsonUtils.toJsonString(orderSignature, true));    }    @Test    public void orderQuery() throws WechatPayException {        OrderQueryRequest request = new OrderQueryRequest();        // 参数二选一        request.setTransaction_id(transaction_id);        request.setOut_trade_no(out_trade_no);        OrderQueryResponse response = WechatPayApi.queryOrder(request);        logger.info(JsonUtils.toJsonString(response, true));    }    @Test    public void orderQuery01() {        try {            OrderQueryResponse response = WechatPayApi.queryOrderByTransactionId(transaction_id);            logger.info(JsonUtils.toJsonString(response, true));        } catch (Exception e) {            e.printStackTrace();        }    }    @Test    public void orderQuery02() {        try {            OrderQueryResponse response = WechatPayApi.queryOrderByOutTradeNo(out_trade_no);            logger.info(JsonUtils.toJsonString(response, true));        } catch (Exception e) {            e.printStackTrace();        }    }}